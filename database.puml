@startuml

hide empty methods

!procedure $schema($name)
package "$name" as $name <<Rectangle>>
!endprocedure

!procedure $table($name)
entity "<b>$name</b>" as $name << (T, Orange) table >>
!endprocedure

!procedure $view($name)
entity "<b>$name</b>" as $name << (V, Aquamarine) view >>
!endprocedure

!procedure $pk($name)
<color:#GoldenRod><&key></color> <b>$name</b>
!endprocedure

!procedure $fk($name)
<color:#Silver><&key></color> $name
!endprocedure

!procedure $column($name)
{field} <color:#White><&media-record></color> $name
!endprocedure

title "Toast Core"

left to right direction

$schema("Users") {
    $table("Users") {
        $pk("id"): INTEGER NOT NULL
        $column("username"): VARCHAR(255) NOT NULL
        $column("password"): VARCHAR(255) NOT NULL
        $column("discordID"): VARCHAR(255) NULL
    }

    $table("UserMindustryServerData") {
        $pk("id"): INTEGER NOT NULL
        $fk("mindustryUserID"): INTEGER NOT NULL
        $column("serverID"): VARCHAR(255) NOT NULL
        $column("xp"): INTEGER NOT NULL DEFAULT 0
        $column("playTime"): INTEGER NOT NULL DEFAULT 0
    }

    $table("MindustryUser") {
        $pk("id"): INTEGER NOT NULL
        $fk("userID"): INTEGER NULL
        $fk("mindustryUUIDID"): INTEGER NULL
    }

    $table("MindustryUUID") {
        $pk("id"): INTEGER NOT NULL
        $column("mindustryUUID"): VARCHAR(255) NULL UNIQUE
    }

    $table("MindustryUserIPAddress") {
        $pk("id"): INTEGER NOT NULL
        $fk("mindustryUserID"): VARCHAR(255) NULL
        $fk("ipAddress"): VARCHAR(255) NULL
    }

    $table("IPAddress") {
        $pk("id"): INTEGER NOT NULL
        $column("ipAddress"): INTEGER NOT NULL
    }

    $table("UserKick") {
        $pk("id"): INTEGER NOT NULL
        $fk("ipAddressID"): Integer NULL
        $fk("userID"): INTEGER NULL
        $fk("mindustryUUIDID"): INTEGER NULL
        $column("reason"): TEXT NOT NULL
        $column("kickedAt"): DATETIME NOT NULL
        $column("kickEndAt"): DATETIME NOT NULL
    }

    $table("UserBan") {
        $pk("id"): INTEGER NOT NULL
        $fk("ipAddressID"): INTEGER NULL
        $fk("userID"): INTEGER NULL
        $fk("mindustryUUIDID"): INTEGER NULL
        $column("reason"): TEXT NOT NULL
        $column("bannedAt"): DATETIME NOT NULL
    }

    Users::id --{ MindustryUser::userID
    UserMindustryServerData::mindustryUserID --|| MindustryUser::id

    MindustryUser::id --{ MindustryUserIPAddress::mindustryUserID
    IPAddress::id --{ MindustryUserIPAddress::ipAddress

    UserKick::ipAddressID --|| IPAddress::id
    UserBan::ipAddressID --|| IPAddress::id
    UserKick::userID --|| Users::id
    UserBan::userID --|| Users::id
    UserKick::mindustryUUIDID --{ MindustryUUID::id
    UserBan::mindustryUUIDID --{ MindustryUUID::id

    MindustryUser::mindustryUUIDID --{ MindustryUUID::id
}

@enduml