@startuml

hide empty methods

!procedure $schema($name)
package "$name" as $name <<Rectangle>>
!endprocedure

!procedure $table($name)
entity "<b>$name</b>" as $name << (T, Orange) table >>
!endprocedure

!procedure $view($name)
entity "<b>$name</b>" as $name << (V, Aquamarine) view >>
!endprocedure

!procedure $pk($name)
<color:#GoldenRod><&key></color> <b>$name</b>
!endprocedure

!procedure $fk($name)
<color:#Silver><&key></color> $name
!endprocedure

!procedure $column($name)
{field} <color:#White><&media-record></color> $name
!endprocedure

title "Toast Core"

left to right direction

$schema("Users") {
    $table("Users") {
        * $pk("id") INTEGER AUTOINCREMENT UNIQUE
        * $column("username") VARCHAR(255)
        * $column("password") VARCHAR(255)
          $column("discordID") VARCHAR(255)
    }

    $table("MindustryUserServerData") {
        * $pk("id") INTEGER AUTOINCREMENT UNIQUE
        * $fk("mindustryUserID") INTEGER
        * $column("serverID") VARCHAR(255)
        * $column("xp") INTEGER DEFAULT 0
        * $column("playTime") INTEGER DEFAULT 0
    }

    $table("MindustryUser") {
        * $pk("id") INTEGER AUTOINCREMENT UNIQUE
          $fk("userID") INTEGER
        * $column("mindustryUUID") VARCHAR(255) UNIQUE
    }

    $table("MindustryPlayerIPAddress") {
        * $pk("id") INTEGER AUTOINCREMENT UNIQUE
        * $fk("mindustryPlayerID") VARCHAR(255)
        * $fk("ipAddress") VARCHAR(255)
    }

    $table("IPAddress") {
        * $pk("id") INTEGER AUTOINCREMENT UNIQUE
        * $column("ipAddress") INTEGER UNIQUE
    }

    $table("UserKick") {
        * $pk("id") INTEGER AUTOINCREMENT UNIQUE
        * $column("reason") TEXT
        * $column("kickedAt") DATETIME
        * $column("kickEndAt") DATETIME
          $fk("ipAddressID") Integer
          $fk("userID") INTEGER
          $fk("mindustryPlayerID") INTEGER
    }

    $table("UserBan") {
        * $pk("id") INTEGER AUTOINCREMENT UNIQUE
        * $column("reason") TEXT
        * $column("bannedAt") DATETIME
          $fk("ipAddressID") INTEGER
          $fk("userID") INTEGER
          $fk("mindustryPlayerID") INTEGER
    }

    Users::id ||--{ MindustryUser::userID
    MindustryUserServerData::mindustryUserID ||--|| MindustryUser::id

    MindustryUser::id ||--{ MindustryPlayerIPAddress::mindustryPlayerID
    IPAddress::id ||--{ MindustryPlayerIPAddress::ipAddress

    UserKick::ipAddressID ||--|| IPAddress::id
    UserKick::userID ||--|| Users::id
    UserKick::mindustryPlayerID ||--|| MindustryUser::id
    UserBan::ipAddressID ||--|| IPAddress::id
    UserBan::userID ||--|| Users::id
    UserBan::mindustryPlayerID ||--|| MindustryUser::id
}

$schema("GameHistory") {
    $table("GameHistory") {
        * $pk("id") INTEGER AUTOINCREMENT UNIQUE
        * $column("duration") INTEGER
        * $column("map") VARCHAR(255)
        * $column("winnerTeam") VARCHAR(255)
    }

    $table("GameHistoryPlayer") {
        * $pk("id") INTEGER AUTOINCREMENT UNIQUE
        * $fk("gameHistoryID") INTEGER
        * $fk("userID") INTEGER --In seconds
    }

    GameHistoryPlayer::gameHistoryID }--|| GameHistory::id
    GameHistoryPlayer::userID }--{ Users.Users::id
}

@enduml